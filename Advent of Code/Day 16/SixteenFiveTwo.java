
import java.awt.Point;
import java.util.*;

public class SixteenFiveTwo {
    // static String input = """
    // #################
    // #...#...#...#..E#
    // #.#.#.#.#.#.#.#.#
    // #.#.#.#...#...#.#
    // #.#.#.#.###.#.#.#
    // #...#.#.#.....#.#
    // #.#.#.#.#.#####.#
    // #.#...#.#.#.....#
    // #.#.#####.#.###.#
    // #.#.#.......#...#
    // #.#.###.#####.###
    // #.#.#...#.....#.#
    // #.#.#.#####.###.#
    // #.#.#.........#.#
    // #.#.#.#########.#
    // #S#.............#
    // #################
    // """;

    static String input = """
    #############################################################################################################################################
    #...#...........#...............#...#.....................#.............#...#.......#.#.............................#.............#.....#..E#
    #.#.#.#########.#.#####.###.###.###.#.#######.###.#######.#####.#####.#.###.#.###.#.#.#.#########.#######.#.###.#.#.#.###.#######.#.#.#.#.#.#
    #.#.#.........................#...#.#...#.....#.#.......#.....#.....#.#.#.....#.#.#...#.......#...................#.#.#.#.#.......#.#.#...#.#
    #.###.#.#####.#######.#####.#.###.#.#.###.#####.#.#.#########.#######.#.#.###.#.#.#######.#.###.###.###.#.#.#.#####.#.#.#.###.###.#.#.###.###
    #.#...#.#.....#.......#.....#...#...#.#...#.....#.#.........#.........#.#.......#.........#.....#.#...#.#...#.....#.#...#...#.#.....#.#.....#
    #.#.###.#.###.#.#####.#.#.#####.###.#.#.###.###.#.#####.#.#####.#######.#############.#####.#####.###.#.#######.#.#.#######.#.#.#####.#.###.#
    #.#...#.#.#.#.................................#.....#...............................#...............................#.......................#
    #.###.###.#.#####.#.#.###.#.#########.#.#####.#######.###.#.#.#.###################.###.#.#.#.#.###.#.###.#########.#.#.#.###.#####.#.###.#.#
    #...#.....#.....#.#.......#...#.......#.#...#.....#...#.#.#...#.#.......#...........#...#.#...#...#.....#.............#...#.#.....#.#.....#.#
    #.#####.#####.###.###########.#.#######.#.#.#######.###.#.#.#.#.#.#####.#.###########.###.#.#####.###########.#############.#####.#.#.#####.#
    #...........#...#.#...........#.....#.#.#.#.......#.#...#.#.#.....#...#...#...#...........#...#.#...........#.#.....#.#.....#.....#.#.....#.#
    #.#####.###.###.#.#.#########.#####.#.#.#.#######.#.#.###.#.###.###.#.#####.#.#.#.#.###.###.#.#.###########.###.#.#.#.#.###.#.###########.#.#
    #.#.....#.......#.#.#...#...#.....#.#.#.#.....#...#.#...#.#.#.......#...#...#.#.#.#...#...#...#.........#.#.......#.#...#.#.#.......#.....#.#
    ###.#.###########.#.#.#.#.#.###.###.#.#.#.#####.###.###.#.#.#######.###.#.###.#.#.###.###.#.#######.###.#.#######.#.#.###.#.#######.#.#######
    #...#.#...........#.#.#...#.....#.....#...#.....#.....#...#...#.....#...#...#.#.#...#.#...#.#.....#...#.#.....#...#.#.....#.#.....#.#.......#
    #.#.###.###########.#############.#########.#########.#.#####.#.#####.#######.#.###.#.#.#.#.###.#.#.#.#.#.#####.#.#.#####.#.#.#.###.#.#####.#
    #...#...#.......#...#...#...........#.......#.........#.#.......#.......#...#...#.#...#.#.#.#...#.#.#.#...#...#.#...#...#.#...#.....#.....#.#
    #.###.#######.###.###.#.#.#####.###.#.#########.#########.#############.#.#.###.#.#####.###.#.###.###.#.###.#.#.#####.###.#.#######.#.#####.#
    #.....#.....#...#.....#...#...#.....#.....#...#...#.........#.......#...#.#...#.......#...#...#...#.....#...#.#.....#...#.....#.............#
    #.#####.###.#.#.###########.#.#####.#####.#.#.#.#.#.#########.#####.###.#.###.#.#######.#.#.#####.#.#.###.###.#.###.###.###.#.#.#.#.###.#.#.#
    #...#...#...#.#...........#.#.....#.#...#...#.#.#...#.......#.....#...#.#...#.#.#.....#.#...#...#...#.#...#.#.#...#...#.....#.#.#.#.....#...#
    ###.#.###.###.#.###.#####.#.#####.###.#.#####.#######.#####.###.#####.#.#.#.#.#.#.###.#.#####.#.#######.###.#.#.#####.#####.#.#.#.#.#######.#
    #.....#...#...#.#...#...#.#.....#.....#.....#.#.......#...#.....#...#.#.#.#.#.#.#...#.#.#.....#.........#...#.#.#.....#...#.#.#.#.#.....#...#
    #.#######.#.###.###.#.#.#.#.###.###########.#.#.#######.#########.#.#.#.#.#.#.#####.#.###.#################.#.###.#.###.#.#.#.#.#.#.#.###.###
    #.#.#...#.#...#...#...#...#...#.#.....#.......#.........#.......#.#...#...#.#.......#.....#.................#...#.#.#...#.#...#.#.........#.#
    #.#.#.#.#.#######.#######.#.#.#.###.#.#.###########.#####.#####.#.#####.#.#.#####.#.#####.#######.#######.#####.#.#.#.###.###.#.###.#####.#.#
    #...#.#.#...#...#.......#.#.#.#...#.#.#.#.#.......#.#.....#.......#...#.#.#.#...#...#.....#.....#.#.....#.#.....#.#.#.#.#...#.#...#.....#...#
    #.###.#.###.#.#.###.###.###.#.###.#.#.#.#.#.#.###.#.#.###############.#.###.#.#.#####.#####.###.###.###.#.#.#####.###.#.###.#####.#.###.###.#
    #.#...#.#...#.#...#...#.....#...#.#.#.....#.#...#.#.#.............#...#...#.#.#.....#.#.....#.#.....#...#...#.............#.#.....#...#...#.#
    ###.###.#.###.###.###.#########.#.#######.#.###.###.#############.#.#####.#.#.#.#####.#.#####.#######.###.###.###########.#.#.#####.#.#.#.#.#
    #...#...#.....#.....#.....#...#.#...#...#.#...#...#.....#.......#.#.......#.#.#...#...#...#.....#.....#...#.........#...#.#.....#...#.#.#.#.#
    #.###.#######.#####.#####.#.#.#.#.#.#.#.###.#.###.#####.#######.#.###.#####.#####.#.#####.#####.#.#######.#.#########.#.#######.#.#.#.#.#.#.#
    #.#...#.......#...#...#...#.#.#.#...#.#.....#.....#...#...#.....#...#.#.#.....#...#.#...#.....#.........#.#.#.....#...#.........#.#.#.#.#.#.#
    #.#.#######.###.#.###.###.#.#.#.#.###.#######.###.#.#.###.#.###.###.#.#.#.###.#.#.#.#.#.###.#.#.#######.#.#.#.###.#.###########.#.#.#.###.#.#
    #.#...#...#...#.#...#...#.#.#.#.#.....#...#...#...#.#...#.#.#.....#.#.....#...#.#.#.#.#...#...#...#...#.#.#.#.#.#.#.........#.....#.#.#...#.#
    #.###.#.#.#.#.#.###.###.###.#.#.#########.#.###.###.#.###.#.#######.#.###.#.###.#.#.#####.#.###.#.###.#.#.###.#.#.###.#####.###.###.#.#.###.#
    #...........#...#.#...#.....#.#.......#...#.#...#...#...#.#.#.......#...#.#.....#.#.......#...#.#.....#.#.....#.#...#.#...#.....#...#.#.#...#
    #.#.###.###.#####.###.#######.###.###.#.#.#.#.###.#####.#.#.#.#########.###.#.###.#.#########.#.###.###.#####.#.###.###.#.#.###.#.###.#.#.###
    #.#.#...#...........#...#.......#.#.....#.#.#.#.#.#.#...#...#.....#.........#.#...#.#.........#...#.#...#.........#.....#.#.#...#.....#.....#
    #.#.###.###.#.#########.###.###.#.#.#######.#.#.#.#.#.#####.#.###.#.#########.#####.#.###########.#.#.###.#.#####.###.#.#.#.#.#.#.#####.###.#
    #.#.....#...#...............#.....#.#.....#.#...#...#.....#.#...#.....#...#.........#.#.#.......#.#.#...#.#...#.........#.#.#.#.............#
    #.#######.#.###.#########.###.###.###.###.#.#######.#####.#.###.#######.#.###.#######.#.#.#.###.#.#####.#.###.#####.#####.#.#.#.#####.#.#.#.#
    #...#.....#...#.........#.....#.......#...#...#.....#...#.....#.#.......#...#.....#...#...#...#.#.....#.#.#.#.#...#.#.....#...#.....#...#.#.#
    #.#.#.#####.#.#########.#######.#######.###.#.#.#####.#########.#.#########.#####.#.###.#####.#.#####.#.#.#.#.#.#.#.#.#####.#.#.###.#####.#.#
    #.#...#.....#...#...#...........#...#.#...#.#.........#.........#.#...........#...#...#.#...#.#.#.....#.#...#...#.#.#...#...#...............#
    #####.#.###.#.#.#.#.#############.#.#.###.#.###########.#.#.#.#.#.#.#########.#######.###.#.#.#.#.###.#.#######.#.#####.#.#.###.#.###.###.###
    #.....#...#.#.#.......#...........#.#...#.#.....#...#...#...#...#.#...#.....#.........#...#...#...#...#.#.....#.......#...#.........#...#...#
    #.###.###.#.#########.#.#########.#.#.#.#.#######.#.#.###.#.#.###.#.#.#.###.###.#.#.###.#.#########.###.#.###.#.###.#.#.#######.#######.###.#
    #.#.......#...........#...#.....#.#.#.#.#...#.....#...#...#.....#.#.#...#.#...#...#.....#.#...#.......#...#...#...#.#.........#.....#...#...#
    #.###.#####.#############.###.#.#.#.#.#.###.#.#####.###.#########.#.#####.#.###########.#.#.#.#.#########.#.#######.#########.#.###.#.###.###
    #...#.....#.........#...#.#...#.#.....#...#.#.........#.#.........#.......#...#.........#...#.#.........#.#.......#.........#.#...#...#...#.#
    #.#.#.###.#.#####.#.#.#.#.#.#.###.#.###.###.#########.#.#.#.#############.###.#.#.#######.#.#.###.#.###.#########.#.#.#######.#.#.#####.###.#
    #.................#.#.#.#.#.#.#...#...#...#.#.....#...#.#.....#.........#...#...#...#...#.#.....#.#...#...........#.#.#...#...#.#.#.#...#...#
    #.###.#.#.#.#.#.###.#.###.#.###.#####.###.#.#.###.#.#########.#.#######.###########.#.#.#.#.#####.###.#####.#########.#.#.#.###.#.#.#.###.#.#
    #.....#.#...#.#.#.....#...#...#.....#.....#.#.#.....#.......#.#.......#.............#.#...#.....#...#.....#.#.......#...#...#...............#
    #####.#.#.#.#.#.#######.#####.#####.#######.#.#.#####.#####.#.#.#####.#######.#####.#####.#####.###.#####.#.#.#####.#.#######.#.#.#.#######.#
    #.....#...#.#.#...................#.#.......#.#.#...#.#.......#.....#.#.........#...#...#...#...#.....#...#.#.#...#.#.....#...#.#.#.#.....#.#
    #.###.###.#.###############.#######.#.#######.###.#.#.#.###.#.#####.#.#.#######.#.###.#.#####.###.###.#.###.#.###.#.#####.###.#.#.#.#.###.#.#
    #.#.......#...........#.....#...#...#.........#...#...#.......#.....#.#.....#...#.#...#...#...#...#...#.#...#.....#...#.#.....#.#.#.#.#.#...#
    ###.#.###.#.#####.###.#####.#.#.#.#######.#####.#################.###.###.#.#.#####.#####.#.###.###.#.#.#.###.#####.#.#.#####.#.#.#.#.#.###.#
    #...#...#.#.....#.....#...#.#.#.#.........#...#.#...#.............#.....#.#...#.....#...#.#.#.......#.#.....#.#...#.#.#.......#.#.#...#.....#
    #.###.###.#######.###.#.#.###.#.###########.#.#.#.#.#######.###.#.#.#.###.#.###.#.###.#.#.#.#.#######.#.###.#.#.#.###.#.#.#####.#.#######.###
    #...#...#.......#.#...#.#.#...#.............#.#...#...#.....#.#.....#.#...#...#.#.#.#.#...#.....#.....#...#.#.#.#.....#.#.#.....#.......#...#
    #.#.#.#.#.#####.#.###.#.#.#.#############.###.#######.#.#####.#####.###.#####.#.#.#.#.#####.#####.###.###.###.#.#########.#.###.#######.###.#
    #.#...#...#.....#...#.#.#.#.#.....#.....#...#.....#...#.#.#...#.....#...#.....#.#.#.#.....#...#...#.#...#.....#...#.......#.#.#.....#...#...#
    #.#.#.#.#.#.#######.###.#.#.###.#.#.###.#.#.#.#####.#.#.#.#.#.#.#####.###.#######.#.#####.#####.###.###.#.#######.#.#####.#.#.#.#.#.#.###.###
    #...#.#.#...#.....#.....#.......#...#.#...#.#.#.....#...#.#.#.#.....#.#...#.....#.#.....#...#...#.....#.#...#.....#.....#.#.#...#.#...#.#...#
    ###.#.#.#.#####.#.#######.###.#######.###.###.#.###.#.###.#.#.###.###.#.###.#.#.#.#.#######.#.###.#####.#.###.#####.###.###.#.#.#.#####.###.#
    #.....#.........#.......#.....#.....#.....#...#.#.....#...#.#...#.#...#...#.#.#.#.#.......#.#.#...#.....#.#...#.....#...#...#.#...#.......#.#
    #.#.###################.#.#####.#.#.#.#####.#.#.###.###.#.#.###.#.#.#####.#.#.#.#.#.#.###.#.#.###.#.#######.###.#####.###.#####.###.#.#####.#
    #...........#...#.....#.#.#.....#.#...#...#.#.#...#...#.#.#...#...#...#...#.#.#...#.#...#...#...#.#.#.....#.#...#...#...#.#.....#.#.#...#...#
    #.#.#.#.###.#.#.#.###.#.###.###.###.###.###.#.###.###.###.#.#.#######.#####.#.#.###.###.#######.#.#.#.###.#.#.###.#####.#.#.#.###.#.###.#.###
    #...#.....#...#.#.#.#.#.....#.#...#...#...#.#...#...#...#...#.#.....#.#.....#...#.....#.#.....#.#.....#...#.#.#.#.....#...#.#.#...#.#...#...#
    ###.#######.###.#.#.#.#######.###.###.###.#.#.#####.###.#.###.#.#.###.#####.###.#####.#.#.###.#.#######.###.#.#.#.###.#####.#.###.#.#.#####.#
    #.#.#...........#...#.............#...#...#.......#...#.#.....#.#.....#...#.#.....#...#...#.#.#...#...#.....#.#.#.#.#.#.....#.......#.#.....#
    #.#.#.#####.#########.#######.#.#.###.#.#.#######.#.#.#.###.###.###.###.#.#.#.###.#.#.#####.#.#.#.###.#.#####.#.#.#.#.#.#######.###.#.#.#.###
    #...#.....#.........#.#.......#.#...#...#.....#.....#.#...#.#.....#.....#.#.......#.#...#...#.#.#...#.....#...#.....#...#.....#...#.#.......#
    #.#.#####.#.#######.###.#######.#.#.#.#########.#####.#.#.#.#####.#######.#######.#.#####.#.#.#####.#####.#.#####.#.###.#.###.###.#######.#.#
    #...#...#.#...#...#.#...#.....#...#.#.#.......#.....#.#.#.#.....#.......#...#.............#.#...#...#.....#.#...#.#...#.....#...#.....#.....#
    ###.###.#.#.#.#.#.#.#.#.#.###.#.#.#.###.#####.#.###.#.###.#####.#.#####.###.#.#####.#######.###.#.###.###.#.#.#.#.###.#.###.#.#.#####.#.#.###
    #.#...#.#.#.#...#.#...#.....#.#.#...#...#.....#...#.#...#...#.#.#.....#...#.#.#...#.....#...#.#.#.#...#.......#.#...#.#.#.........#...#.#...#
    #.###.#.#.#.#.###.#.###.#####.#.#####.###.#########.###.###.#.#.#####.###.#.#.#.#.#####.#.#.#.#.#.#.#.###.#####.###.#.#.#.#######.#.###.#.#.#
    #...#.#.#.#.....#.#.#...#.....#.#.........#.........#.#...#.#.#.....#.#...#...#.#.#.....#.#...#...#.#...#.#...#...#...#.#.......#.#.....#...#
    #.#.#.#.#.#.###.#.###.#.#.#####.#.#.###.#####.#####.#.###.#.#.#####.#.#.#.#####.#.#.#####.###.#####.###.#.#.#.###.#.#####.#####.#.#######.###
    #.#.#...#.#.#.#.#.#...#.#.......#.#.#.#.....#.#...#.....#...#.......#.#.#.......#.#.#...#.#.#.......#...#.#.#...#.#.....#.....#.........#...#
    #.#.###.#.#.#.#.#.#.###.###########.#.#####.#.#.#.#####.#####.#########.#.#####.###.#.#.#.#.#######.#.###.#####.#.#####.#####.###.#.###.#.#.#
    #...............#.#.#.#.......#.....#.....#.#.#.#.....#.#.#...#.........#.#...#.....#.#...#.......#...#.#.......#.#.........#.....#.#...#.#.#
    #.#####.#######.#.#.#.#.#.###.#.#######.###.#.#####.#.#.#.#.#####.#.#####.#.#########.#########.#######.#######.#.#########.#####.#.#.###.#.#
    #...#.....#...#.#.#.#.#.#...#...#.....#.....#.....#.#.....#...#...#.#.....#.......#.#...#.....#.....#.........#.#.........#.......#.#.#...#.#
    #.#.#.#####.#.#.#.#.#.#.###.#.###.###.#.#######.#.###########.#.#####.#######.###.#.###.#.###.#.#.###.#######.#.#########.#######.#.#.#.#.#.#
    #.#.#.#.....#...#...#...#.#.........#.#.......#.#...........#.#...#...#.......#...#...#...#...#.#.......#...#.#.#.........#...#.....#...#...#
    #.#.#.#.#########.###.###.###########.###.###.#.###########.#.###.#.###.#######.###.#.#####.###.###.###.#.#.#.#.#.#.#.#####.###.#.#####.#.#.#
    #.#.#.#.....#.....#...#...#.....#.....#...#...#.#.#.....#...#...#...#...#.#...#...#.#.....#.#.#...#...#.#.#.#.#.#.#...#.#...............#.#.#
    #.#.#.#####.###.#####.#.#.#.#####.#####.#.#.#.#.#.#.###.#.#####.#.#####.#.#.#.###.#.#.###.#.#.###.#.#.#.#.#.#.#.#.#####.#.#######.###.###.#.#
    #.........#...#.....#...#.#.#.....#.....#.#.#.....#.#...........#.......#...#...#...#.#.#.#.#.....#.......#.#...#...#...#.#.....#.#.......#.#
    #.#.#.#######.#.###.#####.#.#.#####.#.###.#.#######.#####.#.#########.#####.#.#.#.###.#.#.#.#######.#######.#.#.###.#.#.#.#.###.#.#######.###
    #.#...#.......#.#...#...#...#.#.....#...#.#.....#...#.......#...#.....#...#...#.#.#...#...#.......#.#.....#...#.....#.#...#...#...#...#.....#
    #.#####.#######.#.###.#.#.###.#########.#.#####.#.#.#.#######.###.#####.#.###.#.#.#.###.#######.#.#.#.#####.#.#.###########.#.#####.#.#.#.#.#
    #.#...#.....#...#...#.#.#.#...#.....#...#.#.......#.#.#.......#...#...#.#.#...#...#.#.#.......#.#...#.....#.#.#.......#...#.#.....#.#.....#.#
    #.#.#.#####.#.#####.#.#.#.#.#.#.###.#.#####.#########.#####.###.#####.#.#.#########.#.#######.#####.#####.#.#########.#.#.#.#####.#.#####.#.#
    #...#.#.....#.#.....#.#...#.#.#.#...#.......#.........#...#...#.#...#.#.#.........#.#.........#...#.....#.#.........#...#.#.#...#...#.....#.#
    ###.###.#####.#.#########.#.###.#.###########.###.#.###.#.#.#.#.#.#.#.#.#########.#.#####.#.###.#.#.#.#.#.###.###########.#.#.#.#####.###.#.#
    #...#...#.....#.#.......#.#.....#.#.............#.#.....#.#.#...#.#.#.#.#...........#.....#.....#...#.......#.............#.#.#.......#.....#
    #.###.###.#####.#.###.#.#########.#.#########.###.#######.###.###.#.#.#.#############.#######.#####.#.#######.#########.#.#.#.#####.#####.#.#
    #.......#.#.....#.#...#.#...#...#...........#...#.......#...#.#...#.#.#.................#.......#...#...#...#.......#.#...#.#.....#.#.....#.#
    #.#####.#.#.#####.###.#.#.#.#.#.#########.###.#.#######.###.#.#.###.#.#########.#.#####.#.#.#####.#######.#.#.###.#.#.#####.###.#.###.###.###
    #.#.....#...#.......#.#.#.#...#.....#...#.#...#.......#.#...#.#.#...#.....#.#...#.#...#.#.#.....#.........#.#...#.#...#.....#.....#.....#...#
    #.#.#####.#.#######.#.#.#.#########.#.###.#.#########.#.#.###.#.#.#####.#.#.#.###.#.###.#.#####.###########.###.#.###.#.#####.#.#.#.#######.#
    #...................#...#...........#.....#.....#...#...#.#...#.#.#.........#.#.#.#...#...#...#.......#.....#.#.#...#.#...#...#...#.#.#.....#
    ###.#.#.#.#.###.#.#.#.###.#.###.###.#.#######.#.###.#.###.#.###.#.#.###.#####.#.#.###.#####.###.#.#.###.#####.#.###.#.#####.###.###.#.#.###.#
    #...#.#.#...#...#.#...#.#.#.....#...#...#...#...#...#.#...#.#...#...#...#.....#.#.........#...#...#...#.#.....#...#.#.......#.....#...#.#...#
    #.###.#.###.#.###.#.###.#.#.#.###.#####.###.#.###.###.#.###.#.#######.###.###.#.#########.###.#.#####.#.#.#.###.#.#.###.#.#####.#####.#.###.#
    #.#...#...#...#...#.#.#...#.#...#.....#.....#.#...#...#...#...#.#...#...#.#.......#.....#.....#.....#...#.#.....#...#...#.........#...#...#.#
    #.#####.#.#.###.#.#.#.#.###.#.#.#####.###.#.#.#.###.#####.#.###.#.#.###.#.###.#####.#.#.#####.#.#.#######.###.#######.#######.#.#.#.#####.###
    #.....#.#...#...#.#.#...#...#.#.....#...#.#...#.....#.....#...#...#...#.#.#...#.....#.#.....#.#.#.#.........#.......#.#.....#...#.#.#...#...#
    #####.#####.#####.#.#.###.#####.###.###.###.###.#####.#####.#.#.#####.#.#.#.#.#.#####.#######.#.###.###############.#.###.#.###.#.#.#.#.###.#
    #...#.....#.....#.#.#...#.....#...#...#.....#.....#...#.....#.#.#.......#.#.#.#.#...#.........#.....#...#...........#.....#.#...#.....#...#.#
    #.#.#####.#.###.#.#.#######.#.###.#.#.#.#.###.#####.###.#####.#.#.#.#####.#.###.#.#.#################.#.#.#########.#######.###.###########.#
    #.........#...#...#.......#.#...#.#...#...#.#.#...#.#.#...#...#.#.#.#...#.#.#...#.#...#...............#...#...#...#...#...#...#...#.....#...#
    #.###.#.###.#.###########.#####.#.#########.#.#.#.#.#.#.#.#.#####.#.#.#.#.#.#.###.###.#.#######.###########.#.#.#####.#.#.###.#.###.###.#.###
    #.#.#.#.....#.........#.#.......#.#.......#.....#...#...#.#.......#.#.#...#...#.....#...#...#...#...........#...#...#.#.#.#.#.......#.#.#...#
    #.#.#.#####.#.#.#####.#.#.#.#####.#.###.###.###.#######.#.#.#######.#.#####.#########.###.#.#.###.###.###########.#.#.#.#.#.###.#####.#.#.#.#
    #.#.#.......#.#...#.....#.#...#.....#.#...#.#.#.#...#...#.#.....#.#...#.#...#.......#.....#...#.....#...#.......#.#...#.#.#.............#.#.#
    #.#.#######.#####.#.#####.###.#.#####.###.#.#.#.#.#.#.#.#.#.###.#.#####.#.###.#####.###.#.#####.###.###.#.#####.#.#####.#.###.#.###.#.#####.#
    #.#...............#.#.........#...#...#.#.....#...#...#.#.....#.#...#...#.#.......#.#...#.....#.#...#...#.....#.........#.#...#...#.#.#...#.#
    #.#####.###.#.#######.###########.#.#.#.###############.###.###.#.###.#.#.###.###.#.###.#####.#.###.#.#.#####.###########.#.#.#.#.###.#.#.#.#
    #.....#.#...#.........#.......#.#...#.......#...#.....#...#.....#.....#.#.#.......#...#.#.....#...#...................#.#...#.#.#.#...#.#...#
    #.###.###.#.#.#######.#.#####.#.###.#########.#.#.#.#.###.#.#########.#.#.#.#.#######.###.#####.#.###.###.###.#.#.###.#.#.#####.#.#.###.#####
    #.........#.#.#.....#.#.#.#...#.....#.........#...#.#...#...#.......#.#.#...#...#...#...#.#...#.#.....#.#.#...#.#...#.#...#.....#.#.#...#...#
    ###.#######.###.###.###.#.#.#.#######.#############.###.#######.###.###.#####.#.###.###.#.###.#.#####.#.#.#.###.#.#.#.#####.#.###.#.#.#.#.#.#
    #...#.....#.......#.#...#.#.#.#...#...#...........#.#...#.....................#...#...#.#...#.#.....#.#...#...#.....#...#...#.#...#.#.#.#.#.#
    #.#####.###########.#.###.#.###.#.#.#######.###.###.#####.#.#.#########.#####.###.#.#.#.###.#.###.###.#.#####.###.#.###.#.###.#.#.#.###.#.#.#
    #.....#.....#...#...#.#...#...#.#...#.......#.#.#...#.....#.#.#...#.....#.....#.....#.#.#...#...#.#...#.................#...#.#.#.#...#...#.#
    #####.###.#.#.#.#.###.###.###.#.#######.#####.#.#.#.#.#.###.#.#.#.#.#####.#.#.#######.#.#.#####.#.#.#######.#####.#.#.#####.#.#.#####.#.###.#
    #...#.....#.#...#...#.....#.#.#...#.....#.......................#.#.......#.#.....................#.#.......#.....#.#.....#...#.......#...#.#
    #.#.#.#####.#.#.###.#####.#.#.###.#.#####.###.#.#.#########.#####.#.#######.#.###.###.#.#.#.#####.#.#.###.###.###.#.#####.###.#############.#
    #.#.#.......#.#...#.......#.#...#.#.#...#...#.#.#...................#...#...#.#.#.....#.#.#.......................#...#.#...#...#.........#.#
    #.###.#######.###.#########.###.#.#.#.#####.#.#.#####.#.#.#.###.#.###.#.#####.#.###.###.#.###############.#####.#.###.#.###.#.#.#####.###.#.#
    #S............#...............#.....#.......#.........#.........#.....#...........#.....#.....................#...........#...........#.....#
    #############################################################################################################################################
    """;

    static final Point[] DIRECTIONS = {
        new Point(0, -1), // North
        new Point(1, 0), // East
        new Point(0, 1), // South
        new Point(-1, 0) // West
    };

    static final Map<Integer, Character> DIRECTION_SYMBOLS = new HashMap<>();
    static {
        DIRECTION_SYMBOLS.put(0, '^'); // North
        DIRECTION_SYMBOLS.put(1, '>'); // East
        DIRECTION_SYMBOLS.put(2, 'v'); // South
        DIRECTION_SYMBOLS.put(3, '<'); // West
    }

    static char[][] maze;
    static int maxX;
    static int maxY;

    static class Path {
        int x, y, total;
        int direction;

        public Path(int x, int y, int direction, int total) {
            this.x = x;
            this.y = y;
            this.total = total;
            this.direction = direction;
        }

        @Override
        public boolean equals(Object obj) {
            if (this == obj) return true;
            if (!(obj instanceof Path)) return false;
            Path other = (Path) obj;
            return x == other.x && y == other.y && direction == other.direction;
        }
        
        @Override
        public int hashCode() {
            return Objects.hash(x, y, direction);
        }
    }

    static class CoordPath extends Path {
        HashSet<Point> coordinates = new HashSet<>();
        HashSet<String> visited  = new HashSet<>();
        char[][] map;

        public CoordPath(int x, int y, int direction, int total, Point startingPoint) {
            super(x, y, direction, total);
            // deep-copy the maze so this path has its own map
            this.coordinates.add(startingPoint);
            // this.map = deepCopyMap(maze);
        }

        public CoordPath(int x, int y, int direction, int total, HashSet<Point> coordinates, HashSet<String> visited, char[][] map) {
            super(x, y, direction, total);
            // copy the collections so different paths don't share the same sets
            if (coordinates != null) {
                this.coordinates = new HashSet<>(coordinates);
            }
            if (visited != null) {
                this.visited = new HashSet<>(visited);
            }
            // deep-copy incoming map (or fall back to a copy of the original maze)
            if (map != null) {
                this.map = deepCopyMap(map);
            }
        }

        public void printMap() {
            for (char[] line : map) {
                System.out.println(new String(line));
            }
        }

        private static String charArrayToString(char[][] input) {
            StringBuilder stringBuilder = new StringBuilder();

            for (char[] line : input) {
                stringBuilder.append(String.valueOf(line));
            }
            return stringBuilder.toString();
        }
    }

    private static char[][] deepCopyMap(char[][] src) {
        if (src == null) return null;
        char[][] copy = new char[src.length][];
        for (int i = 0; i < src.length; i++) {
            copy[i] = src[i].clone();
        }
        return copy;
    }

    private static void parseInput() {
        String[] splitInput = input.trim().split("\n");
        maze = new char[splitInput.length][];
        for (int lineIndex = 0; lineIndex < splitInput.length; lineIndex++) {
            maze[lineIndex] = splitInput[lineIndex].toCharArray();
        }

        maxX = maze[0].length;
        maxY = maze.length;
    }

    private static Point findStartingLocation() {
        for (int x = 1; x < maxX - 1; x++) {
            for (int y = 1; y < maxY - 1; y++) {
                if (maze[y][x] == 'S') {
                    return new Point(x, y);
                }
            }
        }

        throw new IllegalStateException("Starting point not found");
    }

    private static boolean nextStepValid(int x, int y) {
        return maze[y][x] != '#';
    }

    private static int findBestPath() {
        Point starting = findStartingLocation();

        Map<String, Integer> visited;
        visited = new HashMap<>();

        PriorityQueue<Path> queue;
        queue = new PriorityQueue<>(Comparator.comparingInt(points -> points.total));

        queue.add(new Path(starting.x, starting.y, 1, 0));

        while (!queue.isEmpty()) {
            Path current = queue.poll();

            String pathKey = current.x + ", " + current.y + ", " + current.direction;

            if (visited.containsKey(pathKey) && visited.get(pathKey) <= current.total) {
                continue;
            }

            visited.put(pathKey, current.total);

            int newX = current.x + DIRECTIONS[current.direction].x;
            int newY = current.y + DIRECTIONS[current.direction].y;

            if (nextStepValid(newX, newY)) {
                if (maze[newY][newX] == 'E') {
                    return current.total + 1;
                }

                queue.add(new Path(newX, newY, current.direction, current.total + 1));
            }

            int leftDirection = (current.direction + 3) % 4;
            queue.add(new Path(current.x, current.y, leftDirection, current.total + 1000));


            int rightDirection = (current.direction + 1) % 4;
            queue.add(new Path(current.x, current.y, rightDirection, current.total + 1000));
        }

        return -1;
    }

    // Compute the set of coordinates that appear on any optimal path (cost == bestPath)
    // Uses two Dijkstra runs on the directional state graph (x,y,direction):
    //  - forward distances from the start
    //  - reversed distances from the end (reverse edges)
    // A state (x,y,dir) is on some optimal path iff distFromStart + distFromEnd == bestPath.
    private static HashSet<Point> findCoordsOnAnyBestPath(int bestPath) {
        Point starting = findStartingLocation();
        Point ending = findEndLocation();

        final int INF = Integer.MAX_VALUE / 4;

        int[][][] distFromStart = new int[maxY][maxX][4];
        int[][][] distFromEnd = new int[maxY][maxX][4];

        for (int y = 0; y < maxY; y++) {
            for (int x = 0; x < maxX; x++) {
                Arrays.fill(distFromStart[y][x], INF);
                Arrays.fill(distFromEnd[y][x], INF);
            }
        }

        // Dijkstra from start (initial direction 1)
        PriorityQueue<Path> pq = new PriorityQueue<>(Comparator.comparingInt(p -> p.total));
        distFromStart[starting.y][starting.x][1] = 0;
        pq.add(new Path(starting.x, starting.y, 1, 0));

        while (!pq.isEmpty()) {
            Path cur = pq.poll();
            if (cur.total != distFromStart[cur.y][cur.x][cur.direction]) continue;

            // forward move
            int nx = cur.x + DIRECTIONS[cur.direction].x;
            int ny = cur.y + DIRECTIONS[cur.direction].y;
            if (nx >= 0 && nx < maxX && ny >= 0 && ny < maxY && nextStepValid(nx, ny)) {
                int nd = cur.total + 1;
                if (nd < distFromStart[ny][nx][cur.direction]) {
                    distFromStart[ny][nx][cur.direction] = nd;
                    pq.add(new Path(nx, ny, cur.direction, nd));
                }
            }

            // left turn
            int ld = (cur.direction + 3) % 4;
            int lcost = cur.total + 1000;
            if (lcost < distFromStart[cur.y][cur.x][ld]) {
                distFromStart[cur.y][cur.x][ld] = lcost;
                pq.add(new Path(cur.x, cur.y, ld, lcost));
            }

            // right turn
            int rd = (cur.direction + 1) % 4;
            int rcost = cur.total + 1000;
            if (rcost < distFromStart[cur.y][cur.x][rd]) {
                distFromStart[cur.y][cur.x][rd] = rcost;
                pq.add(new Path(cur.x, cur.y, rd, rcost));
            }
        }

        // Reversed Dijkstra from end: start from end cell in any direction with distance 0
        PriorityQueue<Path> pq2 = new PriorityQueue<>(Comparator.comparingInt(p -> p.total));
        for (int d = 0; d < 4; d++) {
            distFromEnd[ending.y][ending.x][d] = 0;
            pq2.add(new Path(ending.x, ending.y, d, 0));
        }

        while (!pq2.isEmpty()) {
            Path cur = pq2.poll();
            if (cur.total != distFromEnd[cur.y][cur.x][cur.direction]) continue;

            // reversed of forward move: predecessor is one step opposite the current direction
            int px = cur.x - DIRECTIONS[cur.direction].x;
            int py = cur.y - DIRECTIONS[cur.direction].y;
            if (px >= 0 && px < maxX && py >= 0 && py < maxY && nextStepValid(px, py)) {
                int nd = cur.total + 1;
                if (nd < distFromEnd[py][px][cur.direction]) {
                    distFromEnd[py][px][cur.direction] = nd;
                    pq2.add(new Path(px, py, cur.direction, nd));
                }
            }

            // reversed of turning: predecessor directions at same cell
            int lpre = (cur.direction + 3) % 4; // turning from lpre -> cur.direction in forward
            int lcost = cur.total + 1000;
            if (lcost < distFromEnd[cur.y][cur.x][lpre]) {
                distFromEnd[cur.y][cur.x][lpre] = lcost;
                pq2.add(new Path(cur.x, cur.y, lpre, lcost));
            }

            int rpre = (cur.direction + 1) % 4; // turning from rpre -> cur.direction in forward
            int rcost = cur.total + 1000;
            if (rcost < distFromEnd[cur.y][cur.x][rpre]) {
                distFromEnd[cur.y][cur.x][rpre] = rcost;
                pq2.add(new Path(cur.x, cur.y, rpre, rcost));
            }
        }

        // Collect coordinates that are part of any optimal path
        HashSet<Point> coords = new HashSet<>();
        for (int y = 0; y < maxY; y++) {
            for (int x = 0; x < maxX; x++) {
                for (int d = 0; d < 4; d++) {
                    int a = distFromStart[y][x][d];
                    int b = distFromEnd[y][x][d];
                    if (a < INF && b < INF && a + b == bestPath) {
                        coords.add(new Point(x, y));
                    }
                }
            }
        }

        return coords;
    }

    private static Point findEndLocation() {
        for (int x = 1; x < maxX - 1; x++) {
            for (int y = 1; y < maxY - 1; y++) {
                if (maze[y][x] == 'E') {
                    return new Point(x, y);
                }
            }
        }

        throw new IllegalStateException("End point not found");
    }

    public static HashSet<Point> amalgamateCoordinates(ArrayList<HashSet<Point>> allPaths) {
        HashSet<Point> allCoords = new HashSet<>();
        for (HashSet<Point> coordSet : allPaths) {
            allCoords.addAll(coordSet);
        }
        return allCoords;
    }

    public static char[][] printCoords(HashSet<Point> coords) {
        char[][] newMaze = deepCopyMap(maze);
        for (Point coord: coords) {
            newMaze[coord.y][coord.x] = 'O';
        }

        for (char[] line: newMaze) {
            System.out.println(Arrays.toString(line));
        }

        return newMaze;
    }

    public static void main(String[] args) {
        // Find starting coordinates
        parseInput();
        int bestPath = findBestPath();
        // Find coordinates that belong to any optimal path without enumerating all paths
        HashSet<Point> coords = findCoordsOnAnyBestPath(bestPath);
        System.out.println("Number of distinct coordinates: " + coords.size());
        // Note: we no longer enumerate all full paths; the count below is number of (x,y,direction) states on optimal paths
        System.out.println("Number of coordinates on optimal states (approx path coverage): " + coords.size());
    }
}

