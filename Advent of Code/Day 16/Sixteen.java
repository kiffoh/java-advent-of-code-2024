
import java.awt.Point;
import java.util.*;

public class Sixteen {
    static String input = """
    ###############
    #.......#....E#
    #.#.###.#.###.#
    #.....#.#...#.#
    #.###.#####.#.#
    #.#.#.......#.#
    #.#.#####.###.#
    #...........#.#
    ###.#.#####.#.#
    #...#.....#.#.#
    #.#.#.###.#.#.#
    #.....#...#.#.#
    #.###.#.#.#.#.#
    #S..#.....#...#
    ###############
    """;

    // static String input = """
    // #############################################################################################################################################
    // #...#...........#...............#...#.....................#.............#...#.......#.#.............................#.............#.....#..E#
    // #.#.#.#########.#.#####.###.###.###.#.#######.###.#######.#####.#####.#.###.#.###.#.#.#.#########.#######.#.###.#.#.#.###.#######.#.#.#.#.#.#
    // #.#.#.........................#...#.#...#.....#.#.......#.....#.....#.#.#.....#.#.#...#.......#...................#.#.#.#.#.......#.#.#...#.#
    // #.###.#.#####.#######.#####.#.###.#.#.###.#####.#.#.#########.#######.#.#.###.#.#.#######.#.###.###.###.#.#.#.#####.#.#.#.###.###.#.#.###.###
    // #.#...#.#.....#.......#.....#...#...#.#...#.....#.#.........#.........#.#.......#.........#.....#.#...#.#...#.....#.#...#...#.#.....#.#.....#
    // #.#.###.#.###.#.#####.#.#.#####.###.#.#.###.###.#.#####.#.#####.#######.#############.#####.#####.###.#.#######.#.#.#######.#.#.#####.#.###.#
    // #.#...#.#.#.#.................................#.....#...............................#...............................#.......................#
    // #.###.###.#.#####.#.#.###.#.#########.#.#####.#######.###.#.#.#.###################.###.#.#.#.#.###.#.###.#########.#.#.#.###.#####.#.###.#.#
    // #...#.....#.....#.#.......#...#.......#.#...#.....#...#.#.#...#.#.......#...........#...#.#...#...#.....#.............#...#.#.....#.#.....#.#
    // #.#####.#####.###.###########.#.#######.#.#.#######.###.#.#.#.#.#.#####.#.###########.###.#.#####.###########.#############.#####.#.#.#####.#
    // #...........#...#.#...........#.....#.#.#.#.......#.#...#.#.#.....#...#...#...#...........#...#.#...........#.#.....#.#.....#.....#.#.....#.#
    // #.#####.###.###.#.#.#########.#####.#.#.#.#######.#.#.###.#.###.###.#.#####.#.#.#.#.###.###.#.#.###########.###.#.#.#.#.###.#.###########.#.#
    // #.#.....#.......#.#.#...#...#.....#.#.#.#.....#...#.#...#.#.#.......#...#...#.#.#.#...#...#...#.........#.#.......#.#...#.#.#.......#.....#.#
    // ###.#.###########.#.#.#.#.#.###.###.#.#.#.#####.###.###.#.#.#######.###.#.###.#.#.###.###.#.#######.###.#.#######.#.#.###.#.#######.#.#######
    // #...#.#...........#.#.#...#.....#.....#...#.....#.....#...#...#.....#...#...#.#.#...#.#...#.#.....#...#.#.....#...#.#.....#.#.....#.#.......#
    // #.#.###.###########.#############.#########.#########.#.#####.#.#####.#######.#.###.#.#.#.#.###.#.#.#.#.#.#####.#.#.#####.#.#.#.###.#.#####.#
    // #...#...#.......#...#...#...........#.......#.........#.#.......#.......#...#...#.#...#.#.#.#...#.#.#.#...#...#.#...#...#.#...#.....#.....#.#
    // #.###.#######.###.###.#.#.#####.###.#.#########.#########.#############.#.#.###.#.#####.###.#.###.###.#.###.#.#.#####.###.#.#######.#.#####.#
    // #.....#.....#...#.....#...#...#.....#.....#...#...#.........#.......#...#.#...#.......#...#...#...#.....#...#.#.....#...#.....#.............#
    // #.#####.###.#.#.###########.#.#####.#####.#.#.#.#.#.#########.#####.###.#.###.#.#######.#.#.#####.#.#.###.###.#.###.###.###.#.#.#.#.###.#.#.#
    // #...#...#...#.#...........#.#.....#.#...#...#.#.#...#.......#.....#...#.#...#.#.#.....#.#...#...#...#.#...#.#.#...#...#.....#.#.#.#.....#...#
    // ###.#.###.###.#.###.#####.#.#####.###.#.#####.#######.#####.###.#####.#.#.#.#.#.#.###.#.#####.#.#######.###.#.#.#####.#####.#.#.#.#.#######.#
    // #.....#...#...#.#...#...#.#.....#.....#.....#.#.......#...#.....#...#.#.#.#.#.#.#...#.#.#.....#.........#...#.#.#.....#...#.#.#.#.#.....#...#
    // #.#######.#.###.###.#.#.#.#.###.###########.#.#.#######.#########.#.#.#.#.#.#.#####.#.###.#################.#.###.#.###.#.#.#.#.#.#.#.###.###
    // #.#.#...#.#...#...#...#...#...#.#.....#.......#.........#.......#.#...#...#.#.......#.....#.................#...#.#.#...#.#...#.#.........#.#
    // #.#.#.#.#.#######.#######.#.#.#.###.#.#.###########.#####.#####.#.#####.#.#.#####.#.#####.#######.#######.#####.#.#.#.###.###.#.###.#####.#.#
    // #...#.#.#...#...#.......#.#.#.#...#.#.#.#.#.......#.#.....#.......#...#.#.#.#...#...#.....#.....#.#.....#.#.....#.#.#.#.#...#.#...#.....#...#
    // #.###.#.###.#.#.###.###.###.#.###.#.#.#.#.#.#.###.#.#.###############.#.###.#.#.#####.#####.###.###.###.#.#.#####.###.#.###.#####.#.###.###.#
    // #.#...#.#...#.#...#...#.....#...#.#.#.....#.#...#.#.#.............#...#...#.#.#.....#.#.....#.#.....#...#...#.............#.#.....#...#...#.#
    // ###.###.#.###.###.###.#########.#.#######.#.###.###.#############.#.#####.#.#.#.#####.#.#####.#######.###.###.###########.#.#.#####.#.#.#.#.#
    // #...#...#.....#.....#.....#...#.#...#...#.#...#...#.....#.......#.#.......#.#.#...#...#...#.....#.....#...#.........#...#.#.....#...#.#.#.#.#
    // #.###.#######.#####.#####.#.#.#.#.#.#.#.###.#.###.#####.#######.#.###.#####.#####.#.#####.#####.#.#######.#.#########.#.#######.#.#.#.#.#.#.#
    // #.#...#.......#...#...#...#.#.#.#...#.#.....#.....#...#...#.....#...#.#.#.....#...#.#...#.....#.........#.#.#.....#...#.........#.#.#.#.#.#.#
    // #.#.#######.###.#.###.###.#.#.#.#.###.#######.###.#.#.###.#.###.###.#.#.#.###.#.#.#.#.#.###.#.#.#######.#.#.#.###.#.###########.#.#.#.###.#.#
    // #.#...#...#...#.#...#...#.#.#.#.#.....#...#...#...#.#...#.#.#.....#.#.....#...#.#.#.#.#...#...#...#...#.#.#.#.#.#.#.........#.....#.#.#...#.#
    // #.###.#.#.#.#.#.###.###.###.#.#.#########.#.###.###.#.###.#.#######.#.###.#.###.#.#.#####.#.###.#.###.#.#.###.#.#.###.#####.###.###.#.#.###.#
    // #...........#...#.#...#.....#.#.......#...#.#...#...#...#.#.#.......#...#.#.....#.#.......#...#.#.....#.#.....#.#...#.#...#.....#...#.#.#...#
    // #.#.###.###.#####.###.#######.###.###.#.#.#.#.###.#####.#.#.#.#########.###.#.###.#.#########.#.###.###.#####.#.###.###.#.#.###.#.###.#.#.###
    // #.#.#...#...........#...#.......#.#.....#.#.#.#.#.#.#...#...#.....#.........#.#...#.#.........#...#.#...#.........#.....#.#.#...#.....#.....#
    // #.#.###.###.#.#########.###.###.#.#.#######.#.#.#.#.#.#####.#.###.#.#########.#####.#.###########.#.#.###.#.#####.###.#.#.#.#.#.#.#####.###.#
    // #.#.....#...#...............#.....#.#.....#.#...#...#.....#.#...#.....#...#.........#.#.#.......#.#.#...#.#...#.........#.#.#.#.............#
    // #.#######.#.###.#########.###.###.###.###.#.#######.#####.#.###.#######.#.###.#######.#.#.#.###.#.#####.#.###.#####.#####.#.#.#.#####.#.#.#.#
    // #...#.....#...#.........#.....#.......#...#...#.....#...#.....#.#.......#...#.....#...#...#...#.#.....#.#.#.#.#...#.#.....#...#.....#...#.#.#
    // #.#.#.#####.#.#########.#######.#######.###.#.#.#####.#########.#.#########.#####.#.###.#####.#.#####.#.#.#.#.#.#.#.#.#####.#.#.###.#####.#.#
    // #.#...#.....#...#...#...........#...#.#...#.#.........#.........#.#...........#...#...#.#...#.#.#.....#.#...#...#.#.#...#...#...............#
    // #####.#.###.#.#.#.#.#############.#.#.###.#.###########.#.#.#.#.#.#.#########.#######.###.#.#.#.#.###.#.#######.#.#####.#.#.###.#.###.###.###
    // #.....#...#.#.#.......#...........#.#...#.#.....#...#...#...#...#.#...#.....#.........#...#...#...#...#.#.....#.......#...#.........#...#...#
    // #.###.###.#.#########.#.#########.#.#.#.#.#######.#.#.###.#.#.###.#.#.#.###.###.#.#.###.#.#########.###.#.###.#.###.#.#.#######.#######.###.#
    // #.#.......#...........#...#.....#.#.#.#.#...#.....#...#...#.....#.#.#...#.#...#...#.....#.#...#.......#...#...#...#.#.........#.....#...#...#
    // #.###.#####.#############.###.#.#.#.#.#.###.#.#####.###.#########.#.#####.#.###########.#.#.#.#.#########.#.#######.#########.#.###.#.###.###
    // #...#.....#.........#...#.#...#.#.....#...#.#.........#.#.........#.......#...#.........#...#.#.........#.#.......#.........#.#...#...#...#.#
    // #.#.#.###.#.#####.#.#.#.#.#.#.###.#.###.###.#########.#.#.#.#############.###.#.#.#######.#.#.###.#.###.#########.#.#.#######.#.#.#####.###.#
    // #.................#.#.#.#.#.#.#...#...#...#.#.....#...#.#.....#.........#...#...#...#...#.#.....#.#...#...........#.#.#...#...#.#.#.#...#...#
    // #.###.#.#.#.#.#.###.#.###.#.###.#####.###.#.#.###.#.#########.#.#######.###########.#.#.#.#.#####.###.#####.#########.#.#.#.###.#.#.#.###.#.#
    // #.....#.#...#.#.#.....#...#...#.....#.....#.#.#.....#.......#.#.......#.............#.#...#.....#...#.....#.#.......#...#...#...............#
    // #####.#.#.#.#.#.#######.#####.#####.#######.#.#.#####.#####.#.#.#####.#######.#####.#####.#####.###.#####.#.#.#####.#.#######.#.#.#.#######.#
    // #.....#...#.#.#...................#.#.......#.#.#...#.#.......#.....#.#.........#...#...#...#...#.....#...#.#.#...#.#.....#...#.#.#.#.....#.#
    // #.###.###.#.###############.#######.#.#######.###.#.#.#.###.#.#####.#.#.#######.#.###.#.#####.###.###.#.###.#.###.#.#####.###.#.#.#.#.###.#.#
    // #.#.......#...........#.....#...#...#.........#...#...#.......#.....#.#.....#...#.#...#...#...#...#...#.#...#.....#...#.#.....#.#.#.#.#.#...#
    // ###.#.###.#.#####.###.#####.#.#.#.#######.#####.#################.###.###.#.#.#####.#####.#.###.###.#.#.#.###.#####.#.#.#####.#.#.#.#.#.###.#
    // #...#...#.#.....#.....#...#.#.#.#.........#...#.#...#.............#.....#.#...#.....#...#.#.#.......#.#.....#.#...#.#.#.......#.#.#...#.....#
    // #.###.###.#######.###.#.#.###.#.###########.#.#.#.#.#######.###.#.#.#.###.#.###.#.###.#.#.#.#.#######.#.###.#.#.#.###.#.#.#####.#.#######.###
    // #...#...#.......#.#...#.#.#...#.............#.#...#...#.....#.#.....#.#...#...#.#.#.#.#...#.....#.....#...#.#.#.#.....#.#.#.....#.......#...#
    // #.#.#.#.#.#####.#.###.#.#.#.#############.###.#######.#.#####.#####.###.#####.#.#.#.#.#####.#####.###.###.###.#.#########.#.###.#######.###.#
    // #.#...#...#.....#...#.#.#.#.#.....#.....#...#.....#...#.#.#...#.....#...#.....#.#.#.#.....#...#...#.#...#.....#...#.......#.#.#.....#...#...#
    // #.#.#.#.#.#.#######.###.#.#.###.#.#.###.#.#.#.#####.#.#.#.#.#.#.#####.###.#######.#.#####.#####.###.###.#.#######.#.#####.#.#.#.#.#.#.###.###
    // #...#.#.#...#.....#.....#.......#...#.#...#.#.#.....#...#.#.#.#.....#.#...#.....#.#.....#...#...#.....#.#...#.....#.....#.#.#...#.#...#.#...#
    // ###.#.#.#.#####.#.#######.###.#######.###.###.#.###.#.###.#.#.###.###.#.###.#.#.#.#.#######.#.###.#####.#.###.#####.###.###.#.#.#.#####.###.#
    // #.....#.........#.......#.....#.....#.....#...#.#.....#...#.#...#.#...#...#.#.#.#.#.......#.#.#...#.....#.#...#.....#...#...#.#...#.......#.#
    // #.#.###################.#.#####.#.#.#.#####.#.#.###.###.#.#.###.#.#.#####.#.#.#.#.#.#.###.#.#.###.#.#######.###.#####.###.#####.###.#.#####.#
    // #...........#...#.....#.#.#.....#.#...#...#.#.#...#...#.#.#...#...#...#...#.#.#...#.#...#...#...#.#.#.....#.#...#...#...#.#.....#.#.#...#...#
    // #.#.#.#.###.#.#.#.###.#.###.###.###.###.###.#.###.###.###.#.#.#######.#####.#.#.###.###.#######.#.#.#.###.#.#.###.#####.#.#.#.###.#.###.#.###
    // #...#.....#...#.#.#.#.#.....#.#...#...#...#.#...#...#...#...#.#.....#.#.....#...#.....#.#.....#.#.....#...#.#.#.#.....#...#.#.#...#.#...#...#
    // ###.#######.###.#.#.#.#######.###.###.###.#.#.#####.###.#.###.#.#.###.#####.###.#####.#.#.###.#.#######.###.#.#.#.###.#####.#.###.#.#.#####.#
    // #.#.#...........#...#.............#...#...#.......#...#.#.....#.#.....#...#.#.....#...#...#.#.#...#...#.....#.#.#.#.#.#.....#.......#.#.....#
    // #.#.#.#####.#########.#######.#.#.###.#.#.#######.#.#.#.###.###.###.###.#.#.#.###.#.#.#####.#.#.#.###.#.#####.#.#.#.#.#.#######.###.#.#.#.###
    // #...#.....#.........#.#.......#.#...#...#.....#.....#.#...#.#.....#.....#.#.......#.#...#...#.#.#...#.....#...#.....#...#.....#...#.#.......#
    // #.#.#####.#.#######.###.#######.#.#.#.#########.#####.#.#.#.#####.#######.#######.#.#####.#.#.#####.#####.#.#####.#.###.#.###.###.#######.#.#
    // #...#...#.#...#...#.#...#.....#...#.#.#.......#.....#.#.#.#.....#.......#...#.............#.#...#...#.....#.#...#.#...#.....#...#.....#.....#
    // ###.###.#.#.#.#.#.#.#.#.#.###.#.#.#.###.#####.#.###.#.###.#####.#.#####.###.#.#####.#######.###.#.###.###.#.#.#.#.###.#.###.#.#.#####.#.#.###
    // #.#...#.#.#.#...#.#...#.....#.#.#...#...#.....#...#.#...#...#.#.#.....#...#.#.#...#.....#...#.#.#.#...#.......#.#...#.#.#.........#...#.#...#
    // #.###.#.#.#.#.###.#.###.#####.#.#####.###.#########.###.###.#.#.#####.###.#.#.#.#.#####.#.#.#.#.#.#.#.###.#####.###.#.#.#.#######.#.###.#.#.#
    // #...#.#.#.#.....#.#.#...#.....#.#.........#.........#.#...#.#.#.....#.#...#...#.#.#.....#.#...#...#.#...#.#...#...#...#.#.......#.#.....#...#
    // #.#.#.#.#.#.###.#.###.#.#.#####.#.#.###.#####.#####.#.###.#.#.#####.#.#.#.#####.#.#.#####.###.#####.###.#.#.#.###.#.#####.#####.#.#######.###
    // #.#.#...#.#.#.#.#.#...#.#.......#.#.#.#.....#.#...#.....#...#.......#.#.#.......#.#.#...#.#.#.......#...#.#.#...#.#.....#.....#.........#...#
    // #.#.###.#.#.#.#.#.#.###.###########.#.#####.#.#.#.#####.#####.#########.#.#####.###.#.#.#.#.#######.#.###.#####.#.#####.#####.###.#.###.#.#.#
    // #...............#.#.#.#.......#.....#.....#.#.#.#.....#.#.#...#.........#.#...#.....#.#...#.......#...#.#.......#.#.........#.....#.#...#.#.#
    // #.#####.#######.#.#.#.#.#.###.#.#######.###.#.#####.#.#.#.#.#####.#.#####.#.#########.#########.#######.#######.#.#########.#####.#.#.###.#.#
    // #...#.....#...#.#.#.#.#.#...#...#.....#.....#.....#.#.....#...#...#.#.....#.......#.#...#.....#.....#.........#.#.........#.......#.#.#...#.#
    // #.#.#.#####.#.#.#.#.#.#.###.#.###.###.#.#######.#.###########.#.#####.#######.###.#.###.#.###.#.#.###.#######.#.#########.#######.#.#.#.#.#.#
    // #.#.#.#.....#...#...#...#.#.........#.#.......#.#...........#.#...#...#.......#...#...#...#...#.#.......#...#.#.#.........#...#.....#...#...#
    // #.#.#.#.#########.###.###.###########.###.###.#.###########.#.###.#.###.#######.###.#.#####.###.###.###.#.#.#.#.#.#.#.#####.###.#.#####.#.#.#
    // #.#.#.#.....#.....#...#...#.....#.....#...#...#.#.#.....#...#...#...#...#.#...#...#.#.....#.#.#...#...#.#.#.#.#.#.#...#.#...............#.#.#
    // #.#.#.#####.###.#####.#.#.#.#####.#####.#.#.#.#.#.#.###.#.#####.#.#####.#.#.#.###.#.#.###.#.#.###.#.#.#.#.#.#.#.#.#####.#.#######.###.###.#.#
    // #.........#...#.....#...#.#.#.....#.....#.#.#.....#.#...........#.......#...#...#...#.#.#.#.#.....#.......#.#...#...#...#.#.....#.#.......#.#
    // #.#.#.#######.#.###.#####.#.#.#####.#.###.#.#######.#####.#.#########.#####.#.#.#.###.#.#.#.#######.#######.#.#.###.#.#.#.#.###.#.#######.###
    // #.#...#.......#.#...#...#...#.#.....#...#.#.....#...#.......#...#.....#...#...#.#.#...#...#.......#.#.....#...#.....#.#...#...#...#...#.....#
    // #.#####.#######.#.###.#.#.###.#########.#.#####.#.#.#.#######.###.#####.#.###.#.#.#.###.#######.#.#.#.#####.#.#.###########.#.#####.#.#.#.#.#
    // #.#...#.....#...#...#.#.#.#...#.....#...#.#.......#.#.#.......#...#...#.#.#...#...#.#.#.......#.#...#.....#.#.#.......#...#.#.....#.#.....#.#
    // #.#.#.#####.#.#####.#.#.#.#.#.#.###.#.#####.#########.#####.###.#####.#.#.#########.#.#######.#####.#####.#.#########.#.#.#.#####.#.#####.#.#
    // #...#.#.....#.#.....#.#...#.#.#.#...#.......#.........#...#...#.#...#.#.#.........#.#.........#...#.....#.#.........#...#.#.#...#...#.....#.#
    // ###.###.#####.#.#########.#.###.#.###########.###.#.###.#.#.#.#.#.#.#.#.#########.#.#####.#.###.#.#.#.#.#.###.###########.#.#.#.#####.###.#.#
    // #...#...#.....#.#.......#.#.....#.#.............#.#.....#.#.#...#.#.#.#.#...........#.....#.....#...#.......#.............#.#.#.......#.....#
    // #.###.###.#####.#.###.#.#########.#.#########.###.#######.###.###.#.#.#.#############.#######.#####.#.#######.#########.#.#.#.#####.#####.#.#
    // #.......#.#.....#.#...#.#...#...#...........#...#.......#...#.#...#.#.#.................#.......#...#...#...#.......#.#...#.#.....#.#.....#.#
    // #.#####.#.#.#####.###.#.#.#.#.#.#########.###.#.#######.###.#.#.###.#.#########.#.#####.#.#.#####.#######.#.#.###.#.#.#####.###.#.###.###.###
    // #.#.....#...#.......#.#.#.#...#.....#...#.#...#.......#.#...#.#.#...#.....#.#...#.#...#.#.#.....#.........#.#...#.#...#.....#.....#.....#...#
    // #.#.#####.#.#######.#.#.#.#########.#.###.#.#########.#.#.###.#.#.#####.#.#.#.###.#.###.#.#####.###########.###.#.###.#.#####.#.#.#.#######.#
    // #...................#...#...........#.....#.....#...#...#.#...#.#.#.........#.#.#.#...#...#...#.......#.....#.#.#...#.#...#...#...#.#.#.....#
    // ###.#.#.#.#.###.#.#.#.###.#.###.###.#.#######.#.###.#.###.#.###.#.#.###.#####.#.#.###.#####.###.#.#.###.#####.#.###.#.#####.###.###.#.#.###.#
    // #...#.#.#...#...#.#...#.#.#.....#...#...#...#...#...#.#...#.#...#...#...#.....#.#.........#...#...#...#.#.....#...#.#.......#.....#...#.#...#
    // #.###.#.###.#.###.#.###.#.#.#.###.#####.###.#.###.###.#.###.#.#######.###.###.#.#########.###.#.#####.#.#.#.###.#.#.###.#.#####.#####.#.###.#
    // #.#...#...#...#...#.#.#...#.#...#.....#.....#.#...#...#...#...#.#...#...#.#.......#.....#.....#.....#...#.#.....#...#...#.........#...#...#.#
    // #.#####.#.#.###.#.#.#.#.###.#.#.#####.###.#.#.#.###.#####.#.###.#.#.###.#.###.#####.#.#.#####.#.#.#######.###.#######.#######.#.#.#.#####.###
    // #.....#.#...#...#.#.#...#...#.#.....#...#.#...#.....#.....#...#...#...#.#.#...#.....#.#.....#.#.#.#.........#.......#.#.....#...#.#.#...#...#
    // #####.#####.#####.#.#.###.#####.###.###.###.###.#####.#####.#.#.#####.#.#.#.#.#.#####.#######.#.###.###############.#.###.#.###.#.#.#.#.###.#
    // #...#.....#.....#.#.#...#.....#...#...#.....#.....#...#.....#.#.#.......#.#.#.#.#...#.........#.....#...#...........#.....#.#...#.....#...#.#
    // #.#.#####.#.###.#.#.#######.#.###.#.#.#.#.###.#####.###.#####.#.#.#.#####.#.###.#.#.#################.#.#.#########.#######.###.###########.#
    // #.........#...#...#.......#.#...#.#...#...#.#.#...#.#.#...#...#.#.#.#...#.#.#...#.#...#...............#...#...#...#...#...#...#...#.....#...#
    // #.###.#.###.#.###########.#####.#.#########.#.#.#.#.#.#.#.#.#####.#.#.#.#.#.#.###.###.#.#######.###########.#.#.#####.#.#.###.#.###.###.#.###
    // #.#.#.#.....#.........#.#.......#.#.......#.....#...#...#.#.......#.#.#...#...#.....#...#...#...#...........#...#...#.#.#.#.#.......#.#.#...#
    // #.#.#.#####.#.#.#####.#.#.#.#####.#.###.###.###.#######.#.#.#######.#.#####.#########.###.#.#.###.###.###########.#.#.#.#.#.###.#####.#.#.#.#
    // #.#.#.......#.#...#.....#.#...#.....#.#...#.#.#.#...#...#.#.....#.#...#.#...#.......#.....#...#.....#...#.......#.#...#.#.#.............#.#.#
    // #.#.#######.#####.#.#####.###.#.#####.###.#.#.#.#.#.#.#.#.#.###.#.#####.#.###.#####.###.#.#####.###.###.#.#####.#.#####.#.###.#.###.#.#####.#
    // #.#...............#.#.........#...#...#.#.....#...#...#.#.....#.#...#...#.#.......#.#...#.....#.#...#...#.....#.........#.#...#...#.#.#...#.#
    // #.#####.###.#.#######.###########.#.#.#.###############.###.###.#.###.#.#.###.###.#.###.#####.#.###.#.#.#####.###########.#.#.#.#.###.#.#.#.#
    // #.....#.#...#.........#.......#.#...#.......#...#.....#...#.....#.....#.#.#.......#...#.#.....#...#...................#.#...#.#.#.#...#.#...#
    // #.###.###.#.#.#######.#.#####.#.###.#########.#.#.#.#.###.#.#########.#.#.#.#.#######.###.#####.#.###.###.###.#.#.###.#.#.#####.#.#.###.#####
    // #.........#.#.#.....#.#.#.#...#.....#.........#...#.#...#...#.......#.#.#...#...#...#...#.#...#.#.....#.#.#...#.#...#.#...#.....#.#.#...#...#
    // ###.#######.###.###.###.#.#.#.#######.#############.###.#######.###.###.#####.#.###.###.#.###.#.#####.#.#.#.###.#.#.#.#####.#.###.#.#.#.#.#.#
    // #...#.....#.......#.#...#.#.#.#...#...#...........#.#...#.....................#...#...#.#...#.#.....#.#...#...#.....#...#...#.#...#.#.#.#.#.#
    // #.#####.###########.#.###.#.###.#.#.#######.###.###.#####.#.#.#########.#####.###.#.#.#.###.#.###.###.#.#####.###.#.###.#.###.#.#.#.###.#.#.#
    // #.....#.....#...#...#.#...#...#.#...#.......#.#.#...#.....#.#.#...#.....#.....#.....#.#.#...#...#.#...#.................#...#.#.#.#...#...#.#
    // #####.###.#.#.#.#.###.###.###.#.#######.#####.#.#.#.#.#.###.#.#.#.#.#####.#.#.#######.#.#.#####.#.#.#######.#####.#.#.#####.#.#.#####.#.###.#
    // #...#.....#.#...#...#.....#.#.#...#.....#.......................#.#.......#.#.....................#.#.......#.....#.#.....#...#.......#...#.#
    // #.#.#.#####.#.#.###.#####.#.#.###.#.#####.###.#.#.#########.#####.#.#######.#.###.###.#.#.#.#####.#.#.###.###.###.#.#####.###.#############.#
    // #.#.#.......#.#...#.......#.#...#.#.#...#...#.#.#...................#...#...#.#.#.....#.#.#.......................#...#.#...#...#.........#.#
    // #.###.#######.###.#########.###.#.#.#.#####.#.#.#####.#.#.#.###.#.###.#.#####.#.###.###.#.###############.#####.#.###.#.###.#.#.#####.###.#.#
    // #S............#...............#.....#.......#.........#.........#.....#...........#.....#.....................#...........#...........#.....#
    // #############################################################################################################################################
    // """;

    static final Point[] DIRECTIONS = {
        new Point(0, -1), // North
        new Point(1, 0), // East
        new Point(0, 1), // South
        new Point(-1, 0) // West
    };

    static char[][] maze;
    static int maxX;
    static int maxY;
    
    static class Path {
        int x, y, total;
        int direction;

        public Path(int x, int y, int direction, int total) {
            this.x = x;
            this.y = y;
            this.total = total;
            this.direction = direction;
        }

        @Override
        public boolean equals(Object obj) {
            if (this == obj) return true;
            if (!(obj instanceof Path)) return false;
            Path other = (Path) obj;
            return x == other.x && y == other.y && direction == other.direction;
        }
        
        @Override
        public int hashCode() {
            return Objects.hash(x, y, direction);
        }
    }

    private static void parseInput() {
        String[] splitInput = input.trim().split("\n");
        maze = new char[splitInput.length][];
        
        for (int i = 0; i < splitInput.length; i++) {
            maze[i] = splitInput[i].toCharArray();
        }

        maxX = maze[0].length;
        maxY = maze.length;
    }

    private static Point findStartingLocation() {
        for (int i = 0; i < maze.length; i++) {
            for (int j = 0; j < maze[0].length; j++) {
                if (maze[i][j] == 'S') {
                    return new Point(j, i);
                }
            }
        }

        throw new IllegalStateException("The character 'S' was not found in the input array.");
    }

    // private static Set<Point> deepCopy(Set<Point> visited) {
    //     Set<Point> visitedCopy = new HashSet<>();
    //     for (Point element: visited) {
    //         visitedCopy.add(new Point(element));
    //     }
    //     return visitedCopy;
    // }

    // private static int minimumInteger(int... totals) {
    //     int pointer = 1;

    //     int min = Math.min(totals[0], totals[pointer]);
        
    //     while (pointer < totals.length - 1) {
    //         pointer++;
    //         min = Math.min(min, totals[pointer]);
    //     }

    //     return min;
    // }

    private static int findBestPath() {
        Point starting = findStartingLocation();

        Map<String, Integer> visited = new HashMap<>();

        PriorityQueue<Path> queue = new PriorityQueue<>(Comparator.comparingInt(points -> points.total));

        queue.add(new Path(starting.x, starting.y, 1, 0));

        while (!queue.isEmpty()) {
            Path current = queue.poll();

            String pathKey = current.x + ", " + current.y + ", " + current.direction;

            if (visited.containsKey(pathKey) && visited.get(pathKey) <= current.total) {
                continue;
            }

            visited.put(pathKey, current.total);

            int newX = current.x + DIRECTIONS[current.direction].x;
            int newY = current.y + DIRECTIONS[current.direction].y;

            if (nextStepValid(newX, newY)) {
                if (maze[newY][newX] == 'E') {
                    return current.total + 1;
                }

                queue.add(new Path(newX, newY, current.direction, current.total + 1));
            }

            int leftDirection = (current.direction + 3) % 4;
            queue.add(new Path(current.x, current.y, leftDirection, current.total + 1000));


            int rightDirection = (current.direction + 1) % 4;
            queue.add(new Path(current.x, current.y, rightDirection, current.total + 1000));
        }

        return -1;
    }

    // private static int findAllPaths(int x, int y, Set<Point> visited, int currentDirection, int total) {
    //         Point delta = directions.get(currentDirection);
    //         int newX = x + delta.x;
    //         int newY = y + delta.y;
    //         Point newCoordinates = new Point(newX, newY);

    //         if (visited.contains(newCoordinates)) return Integer.MAX_VALUE;

    //         // System.err.println("currentPath: " + visited);
    //         // System.err.println("x, y: ( " + x + ", " + y + " )");
    //         if (maze[newY][newX] == 'E' ) {
    //             return total;
    //         }

    //         if (nextStepValid(newX, newY)) {
    //             visited.add(newCoordinates);
    //             int leftDirection = (currentDirection - 1 >  0) ? currentDirection - 1 : 4 - 1;
    //             int rightDirection = (currentDirection + 1) % 4;
    //             return minimumInteger(
    //                 findAllPaths(newX, newY, visited, currentDirection, total + 1),
    //                 findAllPaths(newX, newY, visited, leftDirection, total + 1000),
    //                 findAllPaths(newX, newY, visited, rightDirection, total + 1000)
    //             );
    //             // visited.remove(newCoordinates);
    //         }

    //         return Integer.MAX_VALUE;
    // }

    private static boolean nextStepValid(int x, int y) {
        return maze[y][x] != '#';
    }

    private static void visualisePath(Set<Point> successfulPath) {
        char[][] path = maze.clone();

        for (Point coordinate: successfulPath) {
            path[coordinate.y][coordinate.x] = 'X';
        }

        for (char[] line: path) {
            System.err.println(line);
        }
        System.err.println("");
    }

    public static void main(String[] args) {
        parseInput();

        int total = findBestPath();

        // Path currentPath = new Path(starting.x, starting.y, directions.get('E'));
        // Set<Point> visited = new HashSet<>();
        // visited.add(new Point(starting.x, starting.y));

        // List<Set> successfulPaths = new ArrayList<>();
        // List<Integer> successfulScores = new ArrayList<>();

        // int total = findBestPath(maxX, maxY, );

        // for (Set path: successfulPaths) {
        //     visualisePath(path);
        // }

        // System.err.println("\nsuccessfulPaths: " + successfulPaths);
        // System.err.println("\nsuccessfulScores: " + successfulScores.toString());

        // int min = Collections.min(successfulScores);
        System.err.println("Minimum path: " + total);
    }
}

